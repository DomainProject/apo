#include <stdlib.h>
#include <assert.h>
#include <stdio.h>
#include <string.h>
#include "ddm.h"

#define NCUS 25
#define NACT 8

int main(int argc, char const **argv) {

  int total_cus = NCUS;
  int total_actors = NACT;
  enum cu_type cus[NCUS] = {
    1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, //0-19
    2,2,2,2, //20-23
    4 //24
  };
  int msg_exch_cost[NCUS][NCUS] = { 
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2 }, // 0
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2 }, // 1 
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2 }, // 2
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2 }, // 3
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2 }, // 4
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2 }, // 5
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, // 6
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, // 7
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, // 8
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, // 9
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //10        
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //11
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //12
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //13
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //14
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //15
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //16
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //17
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //18
    { 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, 2,2,2,2, 2}, //19
    { 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, 1,1,1,1, 3 }, //20 gpu
    { 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, 1,1,1,1, 3 }, //21 gpu
    { 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, 1,1,1,1, 3 }, //22 gpu
    { 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, 1,1,1,1, 3 }, //23 gpu
    { 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2, 3,3,3,3, 1 }  //24 fpga
  };
  short runnable_on[NACT] = { 1,1,1,1,3,7,7,7 };
  int cu_capacity[NCUS] = { 
    200,200,200,200,200,200,200,200,200,200,
    200,200,200,200,200,200,200,200,200,200,
    500,500,500,500,
    300
    };


  ddm_init(total_cus,total_actors,cus,msg_exch_cost,runnable_on,cu_capacity);

  // <annoynace,msg_exchange_rate>
  struct actor_matrix actors[NACT][NACT] = {
    { { 0,0 }, { 20,10 }, { 10,20 }, { 0,10 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 } }, //0
    { { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 } }, //1
    { { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 } }, //2
    { { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 } }, //3
    { { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 } }, //4
    { { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,35 }, { 0,0 } }, //5
    { { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,20 } }, //6
    { { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 }, { 0,0 } }  //7
  };

  int tasks_forecast[NACT] = { 50,50,50,50,20,50,50,80 };

 
  enum cu_type *res = ddm_optimize(total_actors,actors,tasks_forecast);

  return 0;
}
