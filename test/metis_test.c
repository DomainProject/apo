#include <stdlib.h>
#include <assert.h>
#include <stdio.h>
#include <string.h>
#include "../src/ddmmetis.h"
#include "../src/ddmmetis/utils.h"

#define NUM_ACTORS 10

real_t comm_cost_matrix[NUM_ACTORS][NUM_ACTORS] = {
    {4.2369917546435465, 4.199421975855084, 3.1814408420868436, 3.2322000113010434, 3.260976863139015, 4.1546579841071285, 3.1826398775800926, 8.102282506379963, 4.9995783283497905, 4.224202042715559},
    {4.926437163261613, 3.8389119708849417, 3.202623802467573, 3.258978470650267, 3.212216086413563, 4.2198055792403135, 3.1922321615260834, 8.390051024759677, 4.852096962680187, 4.250181145069283},
    {4.830914002299457, 4.357294982466177, 3.2409929382515346, 3.211816407915814, 3.292151785963484, 4.271763783947762, 3.2625755771300136, 8.453200227404114, 4.89885934691689, 4.297343207803737},
    {4.8580921401464305, 4.237391433141297, 3.289753714976986, 3.2329993682965426, 3.1626559526926123, 4.203019082334831, 3.261776220134514, 8.254160335524812, 4.805334578443483, 4.208614581303324},
    {4.84889953469819, 4.217007829756066, 3.1982273389923273, 3.248187151211028, 3.1822401990823432, 4.201820046841582, 3.2857569299994904, 8.449603120924367, 4.794942937501993, 4.291747708835242},
    {4.784950975058253, 4.251779859060282, 3.2693701115917566, 3.2393942242605362, 3.20542155195182, 3.88087821314865, 3.1654537021768596, 8.415230770117901, 4.846501463711692, 4.2505808235670335},
    {4.912848094338126, 4.241787896616542, 3.2282032263235476, 3.1726479151363525, 3.2761646460534997, 4.322522953161962, 3.2078196229383176, 8.476781258771341, 4.915246165324624, 4.160253483075623},
    {4.752177338242785, 4.228598506190805, 3.1998260529833256, 3.2541823286772718, 3.231000975807795, 4.115089812829917, 3.2010250884765745, 6.415639245876635, 4.715007237952072, 4.151860234622881},
    {4.973998904493816, 4.256576001033277, 3.187436019553088, 3.2062209089473193, 3.2098180154270657, 4.208614581303324, 3.221808370359554, 8.211394736265603, 4.167447696035116, 4.119486276305163},
    {4.855694069159933, 4.239389825630044, 3.2058212304495695, 3.1938308755170817, 3.2010250884765745, 4.244985324598539, 3.2070202659428184, 8.350083174984716, 4.855694069159933, 3.8117338330379686}
};

real_t anno_matrix[NUM_ACTORS][NUM_ACTORS] = {
      {0.08712991250941356, 0.3353302596119173, 0.4968003727027572, 0.5575515043606969, 0.5679431453021866, 0.3321328316299205, 0.49560133720950833, 0.3872884643193658, 0.22302060174427876, 0.32453894017267804},
    {0.2745791279539776, 0.08553119851841515, 0.4232595291168301, 0.4540347734435496, 0.4636270573895401, 0.1714620755345799, 0.4228598506190805, 0.29216498185496015, 0.24700131160925495, 0.15547493562459577},
    {0.035571386299714715, 0.03357299381096669, 0.07234180809267823, 0.07274148659042784, 0.07354084358592704, 0.03317331531321709, 0.06434823813768617, 0.045163670245705195, 0.03637074329521392, 0.034372350806465904},
    {0.029975887331220263, 0.0339726723087163, 0.07314116508817745, 0.07034341560393022, 0.0683450231151822, 0.035971064797464314, 0.07513955757692546, 0.04716206273445321, 0.02717813784697304, 0.030375565828969865},
    {0.035571386299714715, 0.035971064797464314, 0.07154245109717902, 0.07034341560393022, 0.06634663062643419, 0.03237395831771788, 0.06634663062643419, 0.04676238423670361, 0.037170100290713125, 0.029176530335721054},
    {0.24580227611600616, 0.15707364961559417, 0.4388469905290646, 0.4580315584210456, 0.4560331659322976, 0.08952798349591118, 0.41846338714383485, 0.30175726580095064, 0.25819230954624384, 0.15267718614034853},
    {0.041166885268209163, 0.035571386299714715, 0.07234180809267823, 0.07154245109717902, 0.07793730706117269, 0.02398070986497621, 0.07314116508817745, 0.04956013372095083, 0.037170100290713125, 0.03317331531321709},
    {0.6774550536855779, 0.592723212162662, 0.7589894672264971, 0.7282142228997776, 0.7374068283480184, 0.6043138885974005, 0.7314116508817744, 0.15547493562459577, 0.6554727363093498, 0.6103090660636445},
    {0.24820034710250377, 0.3345309026164181, 0.5591502183516953, 0.5223797965587318, 0.5359688654822183, 0.32533829716817725, 0.5375675794732168, 0.37210068140488084, 0.08633055551391436, 0.3381280090961646},
    {0.2649868440079871, 0.16027107759759102, 0.42965438508082376, 0.430453742076323, 0.4436431325020599, 0.15427590013134695, 0.4340508485560694, 0.27777655593597445, 0.2497990610935022, 0.07633859307017427}
};


int main(void)
{
	idx_t total_actors = NUM_ACTORS;
	idx_t total_cus = N_CU_TYPES;

	ddmmetis_init(total_actors, total_cus);

	idx_t tasks_forecast[NUM_ACTORS] = {50, 50, 50, 50, 20, 50, 50, 80, 10, 10};
    idx_t capacity[N_CU_TYPES] = {4, 4, 2};

	metis_partitioning(total_actors, total_cus, tasks_forecast, capacity, comm_cost_matrix, anno_matrix);
	int *res;

	/*while((res = ddm_poll()) == NULL) {
		printf(".");
	}
	printf("\n");

	for(int i = 0; i < total_actors; ++i) {
		printf("%2d -> %2d\n", i, res[i]);
	}
	free(res);*/

	return 0;
}
