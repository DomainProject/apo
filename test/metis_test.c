#include <stdlib.h>
#include <assert.h>
#include <stdio.h>
#include <string.h>
#include "../src/ddmmetis.h"
#include "../src/ddmmetis/utils.h"

#define NUM_ACTORS 10

real_t comm_cost_matrix[NUM_ACTORS][NUM_ACTORS] = {
    {4.236991754643546f, 4.19942197585508f, 3.181440842086843f, 3.232200011301043f, 3.26097686313901f, 4.154657984107128f, 3.182639877580092f, 8.10228250637996f, 4.999578328349790f, 4.224202042715559f},
    {4.92643716326161f, 3.838911970884941f, 3.20262380246757f, 3.25897847065026f, 3.21221608641356f, 4.219805579240313f, 3.192232161526083f, 8.39005102475967f, 4.85209696268018f, 4.250181145069283f},
    {4.83091400229945f, 4.35729498246617f, 3.240992938251534f, 3.21181640791581f, 3.29215178596348f, 4.27176378394776f, 3.262575577130013f, 8.45320022740411f, 4.8988593469168f, 4.297343207803737f},
    {4.858092140146430f, 4.23739143314129f, 3.28975371497698f, 3.232999368296542f, 3.162655952692612f, 4.20301908233483f, 3.26177622013451f, 8.25416033552481f, 4.80533457844348f, 4.208614581303324f},
    {4.8488995346981f, 4.21700782975606f, 3.198227338992327f, 3.24818715121102f, 3.182240199082343f, 4.20182004684158f, 3.285756929999490f, 8.44960312092436f, 4.79494293750199f, 4.291747708835242f},
    {4.78495097505825f, 4.25177985906028f, 3.269370111591756f, 3.239394224260536f, 3.2054215519518f, 3.8808782131486f, 3.165453702176859f, 8.41523077011790f, 4.84650146371169f, 4.2505808235670335f},
    {4.91284809433812f, 4.24178789661654f, 3.228203226323547f, 3.172647915136352f, 3.276164646053499f, 4.32252295316196f, 3.207819622938317f, 8.47678125877134f, 4.91524616532462f, 4.160253483075623f},
    {4.75217733824278f, 4.22859850619080f, 3.199826052983325f, 3.254182328677271f, 3.23100097580779f, 4.11508981282991f, 3.201025088476574f, 6.41563924587663f, 4.71500723795207f, 4.151860234622881f},
    {4.97399890449381f, 4.25657600103327f, 3.18743601955308f, 3.206220908947319f, 3.209818015427065f, 4.20861458130332f, 3.22180837035955f, 8.21139473626560f, 4.16744769603511f, 4.119486276305163f},
    {4.85569406915993f, 4.23938982563004f, 3.205821230449569f, 3.193830875517081f, 3.201025088476574f, 4.24498532459853f, 3.207020265942818f, 8.35008317498471f, 4.85569406915993f, 3.8117338330379686f}
};

real_t anno_matrix[NUM_ACTORS][NUM_ACTORS] = {
      {0.0871299125094135f, 0.335330259611917f, 0.496800372702757f, 0.557551504360696f, 0.567943145302186f, 0.332132831629920f, 0.4956013372095083f, 0.387288464319365f, 0.2230206017442787f, 0.32453894017267804f},
    {0.274579127953977f, 0.0855311985184151f, 0.423259529116830f, 0.454034773443549f, 0.463627057389540f, 0.171462075534579f, 0.422859850619080f, 0.2921649818549601f, 0.2470013116092549f, 0.15547493562459577f},
    {0.03557138629971471f, 0.0335729938109666f, 0.0723418080926782f, 0.0727414865904278f, 0.0735408435859270f, 0.0331733153132170f, 0.0643482381376861f, 0.04516367024570519f, 0.0363707432952139f, 0.034372350806465904f},
    {0.02997588733122026f, 0.033972672308716f, 0.0731411650881774f, 0.0703434156039302f, 0.068345023115182f, 0.03597106479746431f, 0.0751395575769254f, 0.0471620627344532f, 0.0271781378469730f, 0.030375565828969865f},
    {0.03557138629971471f, 0.03597106479746431f, 0.0715424510971790f, 0.0703434156039302f, 0.0663466306264341f, 0.0323739583177178f, 0.0663466306264341f, 0.0467623842367036f, 0.03717010029071312f, 0.029176530335721054f},
    {0.2458022761160061f, 0.1570736496155941f, 0.438846990529064f, 0.458031558421045f, 0.456033165932297f, 0.0895279834959111f, 0.4184633871438348f, 0.3017572658009506f, 0.2581923095462438f, 0.15267718614034853f},
    {0.04116688526820916f, 0.03557138629971471f, 0.0723418080926782f, 0.0715424510971790f, 0.0779373070611726f, 0.0239807098649762f, 0.0731411650881774f, 0.0495601337209508f, 0.03717010029071312f, 0.03317331531321709f},
    {0.677455053685577f, 0.59272321216266f, 0.758989467226497f, 0.728214222899777f, 0.737406828348018f, 0.604313888597400f, 0.731411650881774f, 0.1554749356245957f, 0.655472736309349f, 0.6103090660636445f},
    {0.2482003471025037f, 0.334530902616418f, 0.559150218351695f, 0.522379796558731f, 0.535968865482218f, 0.3253382971681772f, 0.537567579473216f, 0.3721006814048808f, 0.0863305555139143f, 0.3381280090961646f},
    {0.264986844007987f, 0.1602710775975910f, 0.4296543850808237f, 0.43045374207632f, 0.443643132502059f, 0.1542759001313469f, 0.434050848556069f, 0.2777765559359744f, 0.249799061093502f, 0.07633859307017427f}
};

idx_t msg_exch_cost = {
        {1, 1, 5, 5},
        {1, 1, 5, 5},
        {3, 3, 7, 7}
    };


int main(void)
{
	idx_t total_actors = NUM_ACTORS;
	idx_t total_cus = N_CU_TYPES;


	ddmmetis_init(total_actors, total_cus);

	idx_t tasks_forecast[NUM_ACTORS] = {50, 50, 50, 50, 20, 50, 50, 80, 10, 10};
    idx_t capacity[N_CU_TYPES] = {4, 4, 2};

	metis_partitioning(total_actors, total_cus, tasks_forecast, capacity, comm_cost_matrix, anno_matrix, msg_exch_cost);
	int *res = metis_get_partitioning();

	for(int i = 0; i < total_actors; ++i) {
		printf("%2d -> %2d\n", i, res[i]);
	}
	free(res);

	return 0;
}
